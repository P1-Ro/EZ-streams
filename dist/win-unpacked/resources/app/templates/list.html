<!doctype html>
<title>Ez streams</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lity/2.3.0/lity.min.css"
      integrity="sha256-JJPripKVOCJjOYmKITdlFQreH9qO1AxbCW4F1IO6EkI=" crossorigin="anonymous"/>
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
<div class=page>
    <h1>List</h1>
    <input id="search" placeholder="Search">
    <div class="container">
        {% for tmp in data %}
            {% if tmp.category %}
                {% if tmp.se != 1 %}
                    </div>
                {% endif %}
                <div class="serie">Season {{ tmp.se }}
            {% else %}
                <div class="tile">
                    {% if tmp.direct_play %}
                        <a href="/play/?url={{ tmp.url_for }}" data-lity>
                    {% else %}
                        <a href="/page/{{ tmp.url_for }}">
                    {% endif %}
                    <div class="title">{{ tmp.title }}</div>
                    {% if tmp.img %}
                        <img src="{{ tmp.img }}">
                    {% endif %}
                    </a>
                </div>
            {% endif %}
        {% endfor %}
        <ul id="pagination" class="pagination-sm"></ul>
        </div>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
          integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
          crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"
            integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"
            integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
            integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lity/2.3.0/lity.min.js"
            integrity="sha256-bnmO5ryf6EEA4SjfdCw4LDIWjboyWJkGH5qXi/ik3ZM=" crossorigin="anonymous"></script>
    <script src="{{ url_for("static", filename="jquery.twbsPagination.min.js") }}"></script>
    <script src="{{ url_for("static", filename="jquery.growl.js") }}"></script>
    <script>

        function makeNotification(title, text){
            $.growl({ title: title, message: text ? text : "" });
        }

        $(function () {
            let init = true;
            const search = $("#search");

            //SEARCH
            search.on("keypress", function (evt) {
                if (evt.keyCode === 13) {
                    window.location.href = "http://" + window.location.hostname + ":" + window.location.port + "/search/" + search.val();
                }
            });

            // ADDING LOADING TO LIGHTBOX
            const callback = function (mutationsList) {
                for (let mutation of mutationsList) {
                    if (mutation.type === 'childList') {
                        if (mutation.addedNodes.length !== 0) {
                            $(".lity-container").append("<img id=\"loader\" src=\"https://media.giphy.com/media/7fJuvwGiTizXa/giphy.gif\">")
                        }

                    }
                }
            };
            const observer = new MutationObserver(callback);
            observer.observe(document.body, {attributes: false, childList: true});

            // INIT OF PAGINATION
            $('#pagination').twbsPagination({
                totalPages: {{ pagination }},
                visiblePages: 7,
                startPage: {{ currentPage }},
                prevText: '<span aria-hidden="true">&laquo;</span>',
                nextText: '<span aria-hidden="true">&raquo;</span>',
                onPageClick: function (event, page) {
                    if (init) {
                        init = false;
                        return;
                    }

                    let url = "http://" + window.location.hostname + ":" + window.location.port + "/page/" + page;
                    console.log(url);
                    window.location.href = url;
                }
            });

        });


    </script>
</div>